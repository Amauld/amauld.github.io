<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #tableau {width: 90%; border:2px solid blue; margin:auto}
        table {table-layout: fixed;}
        th,
        td {
            border: 1px solid gray;
            padding: 8px 10px;
            width: 11%;
            max-width: 11%;
        }
        tr {
            border-radius: 20px;
        }
        .tr_gauche {
            border-radius: 30px 0 0 30px;
            width: 5%;
        }
        .tr_droite {
            border-radius: 0 30px 30px 0;
        }
        caption {
            font-weight: bold;
            padding: 10px;
            position: relative;
        }
        .ligne_rouge {
            background-color: red;
        }
        .ligne_vert {
            background-color: green;
        }
        .ligne_bleu {
            background-color: blue;
        }
        .ligne_cyan {
            background-color: cyan;
        }
    </style>
    <script>
        let listeTaches
        let montrerAccompli = false
        document.onreadystatechange = function(){
            document.onreadystatechange = function () {
                if (document.readyState == "complete") {
                    main();
                }
            };
        }
        function main(){
            document.getElementById("tableauTaches").innerHTML = ("")
            montrerAccompli = document.getElementById("montrerAccompliCheckbox").checked
            console.log(montrerAccompli)

            let priorites=[{"idPriorite":"1","priorite":"Très important"},{"idPriorite":"2","priorite":"Important"},{"idPriorite":"3","priorite":"Assez important"},{"idPriorite":"4","priorite":"Peu important"},{"idPriorite":"5","priorite":"Non important"}]
            // console.log(priorites)
            let couleurs=[{"idCouleur":"rouge","code":"#FF0000"},{"idCouleur":"vert","code":"#00FF00"},{"idCouleur":"bleu","code":"#0000FF"},{"idCouleur":"cyan","code":"#00FFFF"}]
            // console.log(couleurs)
            let categories=[{"idCategorie":"1","categorie":"Personnel"},{"idCategorie":"2","categorie":"Professionel"},{"idCategorie":"3","categorie":"Autre"}]
            // console.log(categories)
            let statuts=[{"idStatut":"1","statut":"En attente"},{"idStatut":"2","statut":"En cours"},{"idStatut":"3","statut":"Accompli"},{"idStatut":"4","statut":"Annulé"}]
            // console.log(statuts)

            let nbTaches = 0
            listeTaches = localStorage.getItem("taches")
            console.log(listeTaches)
            listeTaches = JSON.parse(listeTaches)
            listeTaches.forEach(function(item,index){
                console.log(item)
                nbTaches += 1
                //let filtre = document.getElementById("idFiltre").value
                //let filtreValeur = document.getElementById("idFiltreValeur").value

                let tacheId = item.idTache
                let prioriteId = item.idPriorite
                let prioriteStr = priorites.find(element => element.idPriorite==prioriteId).priorite
                let categorieId = item.idCategorie
                let categorieStr = categories.find(element => element.idCategorie==categorieId).categorie
                let statutId = item.idStatut
                let statutStr = statuts.find(element => element.idStatut==statutId).statut
                let couleurId = item.idCouleur
                //let couleurStr = couleurs.find(element => element.couleurId==couleurId).code

                if ((statutId != 3 && statutId != 4 && !montrerAccompli) || ((statutId == 3) && montrerAccompli)) {
                    let ligne = `<tr id="tache${nbTaches}" class="ligne_${couleurId}"><th scope="row" class="tr_gauche">${tacheId}</th><th>${item.nom}</th><th>${item.desc}</th><th>${item.lieu}</th><th>${item.dateTache}</th><th>${prioriteStr}</th><th>${categorieStr}</th><th>${statutStr}</th><th class="tr_droite">
                        <input type="radio" id="radio1_${tacheId}" name="r${tacheId}" value="1" onclick="changeStatut(${tacheId},1)"><label for="radio1_${tacheId}">En attente</label><br>
                        <input type="radio" id="radio2_${tacheId}" name="r${tacheId}" value="2" onclick="changeStatut(${tacheId},2)"><label for="radio2_${tacheId}">En cours</label><br>
                        <input type="radio" id="radio3_${tacheId}" name="r${tacheId}" value="3" onclick="changeStatut(${tacheId},3)"><label for="radio3_${tacheId}">Accompli</label><br>
                        <input type="radio" id="radio4_${tacheId}" name="r${tacheId}" value="4" onclick="changeStatut(${tacheId},4)"><label for="radio4_${tacheId}">Annulé</label><br></th></tr>`;
                    
                    console.log(ligne)
                    document.getElementById("tableauTaches").insertAdjacentHTML('beforeend',ligne);
                    document.getElementById("radio"+statutId+"_"+tacheId).checked = true
                }
                
                
            })
        }
        function changeStatut(tacheId,nouvId){
            console.log(tacheId+" "+nouvId)
            let tache = listeTaches.find(element => element.idTache==tacheId)
            tache.idStatut = nouvId
            updateStorage()
            main()
        }
        function updateStorage(){
            listeTachesString = JSON.stringify(listeTaches)
            localStorage.setItem("taches",listeTachesString)
        }
    </script>
</head>
    <body>
        <div id="tableau">
        <table>
            <caption>
                Taches
            </caption>
            <thead>
                <tr>
                    <th scope="col" class="tr_gauche">N°</th>
                    <th scope="col">Nom</th>
                    <th scope="col">Description</th>
                    <th scope="col">Lieu</th>
                    <th scope="col">Date</th>
                    <th scope="col">Priorité</th>
                    <th scope="col">Catégorie</th>
                    <th scope="col">Statut</th>
                    <th scope="col">Changer statut</th>
                    <th scope="col" class="tr_droite"><input type="checkbox" id="montrerAccompliCheckbox" name="montrerAccompli" onclick="main()">
                        <label for="montrerAccompliCheckbox">Afficher accompli</label><br>
                    </th>
                    <!-- <th scope="col">Type de filtre :<select name="filtre" id="idFiltre">
                        <option value="">Aucun</option>
                        <option value="priorite">Priorité</option>
                        <option value="categorie">Catégorie</option>
                        <option value="statut">Statut</option>
                        </select>
                        Valeur :<select name="filtreValeur" id="idFiltreValeur">
                        <option value="">------</option>
                        </select>
                    </th> -->
                </tr>
            </thead>
            <tbody id="tableauTaches">
                <!-- <tr>
                    <th scope="row">Python</th>
                    <th>Polyvalent</th>
                    <th>Avancé</th>
                </tr>
                <tr>
                    <th scope="row">C</th>
                    <th>Développement</th>
                    <th>Débutant</th>
                </tr>
                <tr>
                    <th scope="row">Lua</th>
                    <th>Jeux</th>
                    <th>Avancé</th>
                </tr>
                <tr>
                    <th scope="row">HTML</th>
                    <th>Web</th>
                    <th>Débutant</th>
                </tr> -->
            </tbody>
        </table>
        </div>
        <p><a href="index.html">Ajouter une tache</a></p>
    </body>
</html>
